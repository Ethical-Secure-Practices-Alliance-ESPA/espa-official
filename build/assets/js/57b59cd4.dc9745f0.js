"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[880],{8823(e,t,s){s.r(t),s.d(t,{default:()=>S});var i=s(6540),a=s(1732);const n=(0,s(3611).UU)("https://kqbotgvulzfklpztmkus.supabase.co","sb_publishable_723TloFOHyj6nvLFZ2bZyw_fBaM4TB7"),o={votingContainer:"votingContainer_BJ5F",topSitesContainer:"topSitesContainer_GVqB","recharts-wrapper":"recharts-wrapper_xFX5",siteList:"siteList_rAfp",siteItem:"siteItem_k1bB",voteButton:"voteButton_GvCm",formRow:"formRow_DBiB"};var r=s(3725),l=s(9241),c=s(7014),u=s(2050),d=s(8880),m=s(3643),h=s(4848);const p=["#D52B1E","#2B2B2B","#6B7280","#8C1D18","#9CA3AF"];function f({adminMode:e=!1,view:t="full"}){const[s,a]=(0,i.useState)([]),[f,v]=(0,i.useState)([]),[b,x]=(0,i.useState)(""),[g,S]=(0,i.useState)(""),[j,_]=(0,i.useState)({}),[w,y]=(0,i.useState)(null),[C,N]=(0,i.useState)(!1),[k,B]=(0,i.useState)(!1);async function F(){const{data:t,error:s}=await n.from("trusted_sites").select("*").order("votes",{ascending:!1});if(!s&&t){const s=t.filter(t=>e||!t.is_hidden);a(s),v(s.slice(0,5))}}return(0,i.useEffect)(()=>{F(),async function(){const e=JSON.parse(localStorage.getItem("espa_submitted")||"false");B(e)}()},[]),(0,h.jsxs)("div",{className:o.votingContainer,children:[("full"===t||"chart"===t)&&f.length>0&&(0,h.jsx)("div",{className:o.topSitesContainer,children:(0,h.jsx)(r.u,{width:"100%",height:300,children:(0,h.jsxs)(l.r,{children:[(0,h.jsx)(c.Fq,{data:f,dataKey:"votes",nameKey:"url",cx:"50%",cy:"50%",outerRadius:100,animationDuration:700,children:f.map((e,t)=>(0,h.jsx)(u.f,{fill:e.id===w?"#FF4D4F":p[t%p.length]},e.id))}),(0,h.jsx)(d.m,{}),(0,h.jsx)(m.s,{})]})})}),("full"===t||"submit"===t)&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("ul",{className:o.siteList,children:s.map(t=>(0,h.jsxs)("li",{className:o.siteItem,children:[(0,h.jsx)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:o.siteLink,children:t.url}),t.rationale&&(0,h.jsx)("p",{className:o.rationale,children:t.rationale}),(0,h.jsxs)("button",{onClick:()=>async function(e){try{const t=JSON.parse(localStorage.getItem("espa_votes")||"{}"),s=t[e]||0,i=3e5;if(Date.now()-s<i)return void alert("Please wait a few minutes before voting again.");a(t=>t.map(t=>t.id===e?{...t,votes:t.votes+1}:t)),v(t=>t.map(t=>t.id===e?{...t,votes:t.votes+1}:t)),y(e);const{error:o}=await n.rpc("increment_votes",{site_id:e});if(o)throw o;t[e]=Date.now(),localStorage.setItem("espa_votes",JSON.stringify(t)),_(t=>({...t,[e]:!0})),setTimeout(()=>_(t=>({...t,[e]:!1})),2500),setTimeout(()=>y(null),1500)}catch(t){console.error("Vote failed:",t),F()}}(t.id),className:o.voteButton,children:["\u25b2 ",t.votes]}),j[t.id]&&(0,h.jsx)("span",{className:o.voteFeedback,children:"Vote recorded"}),e&&(0,h.jsx)("button",{onClick:()=>async function(t){e&&(await n.from("trusted_sites").update({is_hidden:!0}).eq("id",t),F())}(t.id),className:o.hideButton,children:"\u2715 Hide"})]},t.id))}),(0,h.jsxs)("div",{className:o.formRow,children:[(0,h.jsx)("input",{type:"text",placeholder:"Submit a trusted website",value:b,onChange:e=>x(e.target.value),disabled:k||C}),(0,h.jsx)("input",{type:"text",placeholder:"Optional rationale",value:g,onChange:e=>S(e.target.value),disabled:k||C}),(0,h.jsx)("button",{onClick:async function(){if(!b.trim())return void alert("Please enter a site URL.");N(!0);const{error:e}=await n.from("trusted_sites").insert({url:b.trim(),rationale:g.trim(),votes:0});e?(console.error(e),alert("Submission failed")):(x(""),S(""),B(!0),localStorage.setItem("espa_submitted","true"),F()),N(!1)},disabled:k||C,children:C?"Submitting\u2026":k?"Submitted":"Submit"})]})]})]})}const v="votingHeader_AhRo",b="chartSection_CT2v",x="splitHero_kGVM",g="splitHeroText_pGGu";function S(){return(0,h.jsx)(a.A,{title:"Community Voting",description:"Submit and vote on trusted websites with the ESPA community.",children:(0,h.jsxs)("main",{className:"container container--lg",children:[(0,h.jsx)("h1",{className:v,children:"Community-Aligned Submitted Sites"}),(0,h.jsx)("section",{className:x,children:(0,h.jsx)("p",{className:g,children:"These rankings reflect collective trust \u2014 curated by the ESPA community. Vote on trusted sites or submit one of your own to support a safer internet."})}),(0,h.jsx)("section",{className:b,children:(0,h.jsx)(f,{})})]})})}}}]);